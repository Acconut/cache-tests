version: 2
jobs:
  proxy_tests:
    docker:
      - image: circleci/node:latest
      - image: mnot/squid
    steps:
      - checkout
      - run:
          name: start test server
          background: Y
          command: npm run server --port=8000
      - run:
          name: test squid
          command: npm run --silent cli --base=http://localhost:8001 > results/squid.json
workflows:
  version: 2
  test:
    jobs:
      - proxy_tests
